{
  "logging": { "logs": { "default": { "level": "INFO" } } },
  "apps": {
    "layer4": {
      "servers": {
        "main": {
          "listen": [":443"],
          "routes": [
            {
              "match": [
                {
                  "tls": { "sni": ["${DOMAIN}"] }
                }
              ],
              "handle": [
                {
                  "handler": "proxy",
                  "upstreams": [ { "dial": ["dnsdist:8053"] } ]
                }
              ]
            },
            {
              "match": [ { "tls": {} } ],
              "handle": [
                {
                  "handler": "proxy",
                  "upstreams": [ { "dial": ["{l4.tls.server_name}:443"] } ]
                }
              ]
            }
          ]
        }
      }
    }
  }
}
