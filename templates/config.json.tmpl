{
  "logging": { "logs": { "default": { "level": "INFO" } } },
  "apps": {
    "layer4": {
      "servers": {
        "main": {
          "listen": [":443"],
          "routes": [
            {
              "match": [{ "tls": { "sni": ["${DOMAIN}"] } }],
              "handle": [
                {
                  "handler": "proxy",
                  "upstreams": [{ "dial": ["dns:8053"] }],
                  "proxy_protocol": "v0"
                }
              ]
            },
            {
              "match": [{ "tls": { "sni": [""] } }],
              "handle": [{ "handler": "terminal" }]
            },
            {
              "match": [{ "tls": {} }],
              "handle": [
                {
                  "handler": "proxy",
                  "upstreams": [{ "dial": ["{l4.tls.server_name}:443"] }]
                }
              ]
            }
          ]
        }
      }
    }
  }
}
